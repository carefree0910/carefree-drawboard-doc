<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-user-guides/production">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Production | carefree-drawboard</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://carefree0910.me/carefree-drawboard-doc/docs/user-guides/production"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Production | carefree-drawboard"><meta data-rh="true" name="description" content="tl;dr"><meta data-rh="true" property="og:description" content="tl;dr"><link data-rh="true" rel="icon" href="/carefree-drawboard-doc/./img/favicon.ico"><link data-rh="true" rel="canonical" href="https://carefree0910.me/carefree-drawboard-doc/docs/user-guides/production"><link data-rh="true" rel="alternate" href="https://carefree0910.me/carefree-drawboard-doc/docs/user-guides/production" hreflang="en"><link data-rh="true" rel="alternate" href="https://carefree0910.me/carefree-drawboard-doc/docs/user-guides/production" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://DK6J5K49I4-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/carefree-drawboard-doc/blog/rss.xml" title="carefree-drawboard RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/carefree-drawboard-doc/blog/atom.xml" title="carefree-drawboard Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="carefree-drawboard" href="/carefree-drawboard-doc/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="/carefree-drawboard-doc/assets/css/styles.147da202.css">
<link rel="preload" href="/carefree-drawboard-doc/assets/js/runtime~main.5faa94e8.js" as="script">
<link rel="preload" href="/carefree-drawboard-doc/assets/js/main.0ce47cb7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">‚≠êÔ∏è If you like carefree-drawboard, give it a star on <a target="_blank" href="https://github.com/carefree0910/carefree-drawboard">GitHub</a>! ‚≠êÔ∏è</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/carefree-drawboard-doc/"><b class="navbar__title text--truncate">üé®</b></a><a class="navbar__item navbar__link" href="/carefree-drawboard-doc/docs/getting-started">Docs</a><a class="navbar__item navbar__link" href="/carefree-drawboard-doc/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/carefree0910/carefree-drawboard" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/carefree-drawboard-doc/docs/getting-started/">Getting Started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/carefree-drawboard-doc/docs/plugins/">Plugins</a><button aria-label="Toggle the collapsible sidebar category &#x27;Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/carefree-drawboard-doc/docs/user-guides/cli">User Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/cli">CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/features">Features</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/keyboard-shortcuts">Keyboard Shortcuts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/configurations">Configurations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/hosting">Hosting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/carefree-drawboard-doc/docs/user-guides/production">Production</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/carefree-drawboard-doc/docs/contributing-guides/contributing">Contributing Guides</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/carefree-drawboard-doc/docs/api-reference/Types">API Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/carefree-drawboard-doc/docs/reference/design-philosophy">Reference</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/carefree-drawboard-doc/docs/about/update-logs">About</a></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/carefree-drawboard-doc/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">User Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Production</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Production</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr">tl;dr<a href="#tldr" class="hash-link" aria-label="Direct link to tl;dr" title="Direct link to tl;dr">‚Äã</a></h2><ul><li>If you just want a quick deploy, use the <a href="/carefree-drawboard-doc/docs/user-guides/hosting#--unified"><code>--unified</code></a> mode and you are all set.</li><li>If you want it more production ready, you should at least modify the <a href="#upload"><code>upload</code></a> logic.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Direct link to Introduction" title="Direct link to Introduction">‚Äã</a></h2><p><code>carefree-drawboard</code> üé® is not designed to be production ready out of the box, because Infinite Drawboard is so powerful that it contains many business logics which may vary from project to project. Currently we implement these logics based on local file system to make it easy for quick start and development, but in order to put it into production, you&#x27;ll need to implement some core interfaces and replace the default implementations with your own. This page is to guide you through the process.</p><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>Good news is <code>carefree-drawboard</code> üé® already abstracted the core interfaces into a single folder - <code>cfdraw/app/endpoints</code>, and each logic is implemented in a single file, so your modifications can be organized easily.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="guidelines">Guidelines<a href="#guidelines" class="hash-link" aria-label="Direct link to Guidelines" title="Direct link to Guidelines">‚Äã</a></h2><p>The <strong>minimum</strong> modifications you need to make are:</p><ol><li>Nothing (if you use the <a href="/carefree-drawboard-doc/docs/user-guides/hosting#--unified"><code>--unified</code></a> mode), congrats!</li></ol><p>The suggested modifications are:</p><ol><li>The <a href="#upload"><code>upload</code></a> logic.</li><li>The <a href="#project"><code>project</code></a> logic.</li></ol><p>The extra modifications you may need to make are:</p><ol><li>The <a href="#environment-variables">Environment Variables</a>.</li><li>The <a href="#user-management">User Management</a> logic.</li><li>The <a href="#loading-page">Loading Page</a> logic.</li><li>The <a href="#hosting">Hosting</a> logic.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-variables">Environment Variables<a href="#environment-variables" class="hash-link" aria-label="Direct link to Environment Variables" title="Direct link to Environment Variables">‚Äã</a></h2><ul><li><strong>[optional]</strong> <code>CFDRAW_API_URL</code>: The url of your backend server.<ul><li>To make things easier, we suggest using the <a href="/carefree-drawboard-doc/docs/user-guides/hosting#--unified"><code>--unified</code></a> mode. In this case, this will also be the url of the frontend server. And since we will use current <code>origin</code> as the default value, you can safely ignore this.</li><li>This is only useful when you split frontend and backend into two servers.</li></ul></li><li><strong>[optional]</strong> <code>CFDRAW_ALLOWED_ORIGINS</code>: You should specify The actual product url as this value, there are mainly two cases:<ul><li>If you are hosting <code>carefree-drawboard</code> üé® directly, you can set it to the <code>CFDRAW_API_URL</code>.<ul><li>And since we will use current <code>origin</code> as the default value, you can safely ignore this.</li><li>But for safety concerns, you should still set it to the actual product url. In this case, we will <strong>NOT</strong> use current <code>origin</code> anymore, so it can serve as a simple security layer.</li></ul></li><li>If you are using <code>carefree-drawboard</code> üé® in an <code>&lt;iframe&gt;</code> or something like that, you should set it to the url of the page that contains the <code>&lt;iframe&gt;</code> (because in this case you should <code>postMessage</code> to <code>carefree-drawboard</code> üé® with your page, see <a href="#useauth"><code>useAuth</code></a> for more details).</li></ul></li><li><strong>[optional]</strong> <code>CFDRAW_UPLOAD_ROOT</code>: The root directory of the uploaded stuffs (images, projects, ...).</li><li>If you customized the upload logics, you can safely ignore this.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upload"><code>upload</code><a href="#upload" class="hash-link" aria-label="Direct link to upload" title="Direct link to upload">‚Äã</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Source codes: <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/app/endpoints/upload.py" target="_blank" rel="noopener noreferrer">cfdraw/app/endpoints/upload.py</a>.</p></div></div><p>This is a good starting point, because it is important, not complicated, and you often have already implemented the related SDKs already.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upload_image"><code>upload_image</code><a href="#upload_image" class="hash-link" aria-label="Direct link to upload_image" title="Direct link to upload_image">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="tldr-1">tl;dr<a href="#tldr-1" class="hash-link" aria-label="Direct link to tl;dr" title="Direct link to tl;dr">‚Äã</a></h4><p>Modify the <a href="https://github.com/carefree0910/carefree-drawboard/blob/1f59e518e856061e6aeef86b460e13a045072e14/cfdraw/app/endpoints/upload.py#L37" target="_blank" rel="noopener noreferrer"><code>ImageUploader</code></a> class locates at <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/app/endpoints/upload.py" target="_blank" rel="noopener noreferrer"><code>cfdraw/app/endpoints/upload.py</code></a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="details">Details<a href="#details" class="hash-link" aria-label="Direct link to Details" title="Direct link to Details">‚Äã</a></h4><p>The default <code>add_upload_image</code> function implements three endpoints:</p><ol><li><code>/upload_image</code>, to &#x27;upload&#x27; the image to the local file system, and get the image URL (based on the saved path).</li><li><code>/fetch_image</code>, which is used in <code>Download</code> plugin in <code>carefree-drawboard</code> üé®. It accepts an image URL and some parameters and should return the corresponding image.</li><li><code>get_image</code>, to accept the image URL as a <code>GET</code> request and return the image (by parsing the image path from the URL and then read it from the local file system). This is used when we set the <code>src</code> property of an <code>&lt;img&gt;</code> HTML tag.</li></ol><p>If you want to put it into production, you can:</p><ol><li>Choose your cloud storage service, and implement the <code>upload_image</code> method of <code>ImageUploader</code> based on the SDKs.</li><li>Based on the corresponding SDKs, implement the <code>fetch_image</code> method of <code>ImageUploader</code>.</li><li><strong>Ignore</strong> the <code>GET</code> request (<code>get_image</code>), because the image URL will now point to the cloud storage, so you don&#x27;t need to parse it yourself.</li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="project"><code>project</code><a href="#project" class="hash-link" aria-label="Direct link to project" title="Direct link to project">‚Äã</a></h2><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Source codes: <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/app/endpoints/project.py" target="_blank" rel="noopener noreferrer">cfdraw/app/endpoints/project.py</a>.</p></div></div><p><code>carefree-drawboard</code> üé® supports project management, which makes it easy to save/load/share/rename your projects. The default implementations are again based on the local file system, so in order to put it into production, you may need to replace it with a database based one.</p><p>Here are the endpoints that you need to consider (we omit the <code>userId</code> parameter here for simplicity):</p><ol><li><code>/save_project</code>, to save the given project to your database. Every project in <code>carefree-drawboard</code> üé® is guaranteed to be JSON-serializable and the fields are rather static, so you can either use Relational Database or Document Database (or other kinds of database you like) to store it.</li><li><code>/get_project/{uid}</code>, to get a project based on the given <code>uid</code>.</li><li><code>/all_projects</code>, to get all available projects. Notice that only meta information of each project will be returned here to reduce the response size.</li><li>(<code>DELETE</code>) <code>/projects/{uid}</code>, to delete the project based on the given <code>uid</code>.</li></ol><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p>The input/output schema of each endpoint is defined in the <code>Python</code> file with <code>pydantic</code>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="hosting">Hosting<a href="#hosting" class="hash-link" aria-label="Direct link to Hosting" title="Direct link to Hosting">‚Äã</a></h2><p>Currently <code>carefree-drawboard</code> üé® is using <code>uvicorn.run</code> to start the backend server no matter what, which might not be sufficient for production. Here&#x27;s the corresponding code:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_Ktv7">cfdraw/utils/exec.py</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_backend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token builtin">str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> log_level</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> constants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">LogLevel</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">rule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;[bold green]Launching Backend&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> get_config</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># I&#x27;m not familiar with production stuffs of `uvicorn`, so currently</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># only the `reload` flag is different.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    uvicorn</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">run</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-interpolation string" style="color:#e3116c">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">module</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">:</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">config</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">entry</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">.</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">{</span><span class="token string-interpolation interpolation">constants</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">.</span><span class="token string-interpolation interpolation">API_VAR</span><span class="token string-interpolation interpolation punctuation" style="color:#393A34">}</span><span class="token string-interpolation string" style="color:#e3116c">&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        host</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">constants</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">DEV_BACKEND_HOST</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        port</span><span class="token operator" style="color:#393A34">=</span><span class="token builtin">int</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">backend_port</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        log_level</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">log_level</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">reload</span><span class="token operator" style="color:#393A34">=</span><span class="token keyword" style="color:#00009f">not</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">prod</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Unfortunately, as the comment says, I&#x27;m not familiar with production stuffs of <code>uvicorn</code>. So if you are an expert, you can modify these codes based on the <code>config.prod</code> flag.</p><blockquote><p>Also see <a href="/carefree-drawboard-doc/docs/user-guides/hosting">Hosting</a> for more details.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="user-management">User Management<a href="#user-management" class="hash-link" aria-label="Direct link to User Management" title="Direct link to User Management">‚Äã</a></h2><p><code>carefree-drawboard</code> üé® supports user management by putting all user-related information into the <code>userStore</code> (locates at <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/.web/src/stores/user.ts" target="_blank" rel="noopener noreferrer"><code>cfdraw/.web/src/stores/user.ts</code></a>), which is a <code>mobx</code> store. If you would like to use your own user system, you may align your user information to the <a href="#properties">Properties</a> of this store (e.g., set the <code>userId</code> as your own user ID).</p><p>After that, you may need to further adjust the endpoints mentioned above to make them work with your user system.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="useauth"><code>useAuth</code><a href="#useauth" class="hash-link" aria-label="Direct link to useauth" title="Direct link to useauth">‚Äã</a></h3><p><code>carefree-drawboard</code> üé® suggests using <code>&lt;iframe&gt;</code> for quick production, so it implements a <code>useAuth</code> hook natively. You don&#x27;t actually need to know about the details behind it, what you need to do are only:</p><ol><li>Modify the <code>CFDRAW_ALLOWED_ORIGINS</code> environment variable to your page&#x27;s URL (this page should contain the <code>&lt;iframe&gt;</code>).</li><li>Use <code>postMessage</code> to post <code>{ userId }</code> to <code>carefree-drawboard</code> üé® (see <a href="#userid"><code>userId</code></a> for more details).</li></ol><p>And <code>carefree-drawboard</code> üé® will recognize the <code>userId</code> and handle the rest for you.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="properties">Properties<a href="#properties" class="hash-link" aria-label="Direct link to Properties" title="Direct link to Properties">‚Äã</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="userid"><code>userId</code><a href="#userid" class="hash-link" aria-label="Direct link to userid" title="Direct link to userid">‚Äã</a></h4><p>In <code>carefree-drawboard</code> üé®, each user should have a unique <code>userId</code>, which is used to:</p><ul><li>Manage projects.</li><li>Manage uploaded images.</li><li>Assign a unique <code>UserRequestQueue</code> to each user (see <a href="/carefree-drawboard-doc/docs/user-guides/features#requestqueue"><code>RequestQueue</code></a> for more details).</li></ul><p>If you want to use your own <code>userId</code>, you may use an <code>&lt;iframe&gt;</code> which points to <code>carefree-drawboard</code> üé®, and then use <code>postMessage</code> to send the <code>userId</code> to the <code>&lt;iframe&gt;</code>.</p><p>We provided an example of the above process: the <a href="https://github.com/carefree0910/carefree-drawboard/blob/19bfaf89cb9c9b284a0633b674888f01fb5ac3bf/cfdraw/.web/src/hooks/useSetup.ts#L38" target="_blank" rel="noopener noreferrer"><code>postPseduoUserId</code></a> function, which locates at <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/.web/src/hooks/useSetup.ts" target="_blank" rel="noopener noreferrer"><code>cfdraw/.web/src/hooks/useSetup.ts</code></a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="loading-page">Loading Page<a href="#loading-page" class="hash-link" aria-label="Direct link to Loading Page" title="Direct link to Loading Page">‚Äã</a></h2><p><code>carefree-drawboard</code> üé® provides a loading page, and you can customize the fade out timing if you want. By default, we will fade out the loading page when all icons of react plugins have loaded. If you want to wait for other resources to load, here&#x27;s a brief guide:</p><ul><li>The loading page will fade out when the <a href="https://github.com/carefree0910/carefree-drawboard/blob/b405bab0557dcb8f37d012b6a9ad6ea9b99af22b/cfdraw/.web/src/hooks/useSetup.ts#L70" target="_blank" rel="noopener noreferrer"><code>isReady</code></a> flag of <code>setupStore</code> (locates at <a href="https://github.com/carefree0910/carefree-drawboard/blob/dev/cfdraw/.web/src/hooks/useSetup.ts" target="_blank" rel="noopener noreferrer"><code>cfdraw/.web/src/hooks/useSetup.ts</code></a>) returns <code>true</code>.</li><li>if you want to wait for other resources to load, you can:<ul><li>add a field to <code>ISetupStore</code>, <code>SetupStore</code> &amp; <code>makeObservable</code>.</li><li>set this field to <code>true</code> only when the resources are loaded.</li><li>modify the <code>isReady</code> property, and make it return <code>true</code> only when this field is <code>true</code>.</li></ul></li></ul><p>You may refer the <a href="https://github.com/carefree0910/carefree-drawboard/blob/b405bab0557dcb8f37d012b6a9ad6ea9b99af22b/cfdraw/.web/src/hooks/useSetup.ts#L291" target="_blank" rel="noopener noreferrer"><code>useCheckIconLoaded</code></a> to see how we wait for all initial icons to load.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2023-07-10T12:17:21.000Z">Jul 10, 2023</time></b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/carefree-drawboard-doc/docs/user-guides/hosting"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Hosting</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/carefree-drawboard-doc/docs/contributing-guides/contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr" class="table-of-contents__link toc-highlight">tl;dr</a></li><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#guidelines" class="table-of-contents__link toc-highlight">Guidelines</a></li><li><a href="#environment-variables" class="table-of-contents__link toc-highlight">Environment Variables</a></li><li><a href="#upload" class="table-of-contents__link toc-highlight"><code>upload</code></a><ul><li><a href="#upload_image" class="table-of-contents__link toc-highlight"><code>upload_image</code></a><ul><li><a href="#tldr-1" class="table-of-contents__link toc-highlight">tl;dr</a></li><li><a href="#details" class="table-of-contents__link toc-highlight">Details</a></li></ul></li></ul></li><li><a href="#project" class="table-of-contents__link toc-highlight"><code>project</code></a></li><li><a href="#hosting" class="table-of-contents__link toc-highlight">Hosting</a></li><li><a href="#user-management" class="table-of-contents__link toc-highlight">User Management</a><ul><li><a href="#useauth" class="table-of-contents__link toc-highlight"><code>useAuth</code></a></li><li><a href="#properties" class="table-of-contents__link toc-highlight">Properties</a><ul><li><a href="#userid" class="table-of-contents__link toc-highlight"><code>userId</code></a></li></ul></li></ul></li><li><a href="#loading-page" class="table-of-contents__link toc-highlight">Loading Page</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/carefree-drawboard-doc/docs/getting-started">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/carefree-drawboard-doc/docs/getting-started/installation/">Installation</a></li><li class="footer__item"><a class="footer__link-item" href="/carefree-drawboard-doc/docs/reference/design-philosophy/">Design Philosophy</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/carefree0910/carefree-drawboard" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/carefree0910" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/carefree-drawboard-doc/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2023 carefree-drawboard, carefree0910. Built with Docusaurus.</div></div></div></footer></div>
<script src="/carefree-drawboard-doc/assets/js/runtime~main.5faa94e8.js"></script>
<script src="/carefree-drawboard-doc/assets/js/main.0ce47cb7.js"></script>
</body>
</html>